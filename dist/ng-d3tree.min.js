!function(){"use strict";var t=function(t,e){var n,r;if(e||(e=[]),t)for(r in t)if(-1==e.indexOf(r)){n=r;break}return n},e=function(e,n){var r;if(e.label){var a;n&&n.hasOwnProperty(e.label)&&(a=n[e.label]),e.hasOwnProperty(a)?r=e.label.concat(":",e[a]):t(e,["id","label"])?(a=t(e,["id","label"]),r=e.label.concat(":",e[a])):(a=t(e),r=e.label.concat(":",e[a]))}else t(e,"id")?(a=t(e,["id"]),r=e[a]):(a=t(e),r=e[a]);return r};angular.module("ngD3tree",[]).directive("reingoldTilfordTree",function(t,n){return{restrict:"EA",scope:{data:"=",labelMap:"=",jsonPath:"@",width:"@",height:"@",id:"@"},template:"<svg></svg>",link:function(t,r,a){var l=t.width,i=t.height,o=t.labelMap,c=n.d3,s=c.layout.tree().size([i,l-160]),d=r.find("svg"),u=c.select(d[0]).attr("width",l).attr("height",i).append("g").attr("transform","translate(40,0)"),f=c.svg.diagonal().projection(function(t){return[t.y,t.x]}),h=function(t){u.selectAll("*").remove();var n=s.nodes(t),r=s.links(n),a=(u.selectAll("path.link").data(r).enter().append("path").attr("class","link").attr("d",f),u.selectAll("g.node").data(n).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.y+","+t.x+")"}));a.append("circle").attr("r",4.5),a.append("text").attr("dx",function(t){return t.children?-8:8}).attr("dy",3).attr("text-anchor",function(t){return t.children?"end":"start"}).text(function(t){return e(t,o)})};t.jsonPath?c.json(t.jsonPath,function(t,e){return t?void console.error(t):void h(e)}):t.$watch("data",function(t,e){return t?h(t):void 0},!0),c.select(self.frameElement).style("height",i+"px")}}}).directive("stickyForceLayout",function(t,n){return{restrict:"EA",scope:{data:"=",labelMap:"=",jsonPath:"@",width:"@",height:"@",id:"@"},template:"<svg></svg>",link:function(t,r,a){var l=t.width,i=t.height,o=t.labelMap,c=n.d3,s=r.find("svg"),d=c.select(s[0]).attr("width",l).attr("height",i).append("g").attr("transform","translate(40,0)"),u=function(t){d.selectAll("*").remove();var n=c.layout.force().nodes(t.nodes).links(t.links).size([l,i]).charge(-200).linkDistance(l/10).start(),r=n.drag().on("dragstart",h),a=d.selectAll("line.link").data(t.links).enter().append("line").attr("class","link"),s=d.selectAll("g.node").data(t.nodes).enter().append("g").attr("class","stickynode").on("dblclick",f).call(r);s.append("text").attr("class","stickynodetext").attr("dx",18).attr("dy",".35em").text(function(t){return e(t,o)}),s.append("circle").attr("r",10),n.on("tick",function(){a.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),s.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})},f=function(t){c.select(this).classed("fixed",t.fixed=!1)},h=function(t){c.select(this).classed("fixed",t.fixed=!0)};t.jsonPath?c.json(t.jsonPath,function(t,e){return t?void console.error(t):void u(e)}):t.$watch("data",function(t,e){return t?u(t):void 0},!0)}}}).directive("collapsibleTree",function(t,n){return{restrict:"EA",scope:{data:"=",labelMap:"=",jsonPath:"@",width:"@",height:"@",id:"@"},template:"<svg></svg>",link:function(t,r,a){var l,i={top:20,right:120,bottom:20,left:120},o=960-i.right-i.left,c=800-i.top-i.bottom,s=t.labelMap,d=n.d3,u=0,f=500,h=d.layout.tree().size([c,o]),p=d.svg.diagonal().projection(function(t){return[t.y,t.x]}),g=r.find("svg"),v=d.select(g[0]).attr("width",o+i.right+i.left).attr("height",c+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),x=function(t){var n=h.nodes(l).reverse(),r=h.links(n);n.forEach(function(t){t.y=180*t.depth});var a=v.selectAll("g.node").data(n,function(t){return t.id||(t.id=++u)}),i=a.enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+t.y0+","+t.x0+")"}).on("click",y);i.append("circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),i.append("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return e(t,s)}).style("fill-opacity",1e-6);var o=a.transition().duration(f).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});o.select("circle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.select("text").style("fill-opacity",1);var c=a.exit().transition().duration(f).attr("transform",function(e){return"translate("+t.y+","+t.x+")"}).remove();c.select("circle").attr("r",1e-6),c.select("text").style("fill-opacity",1e-6);var d=v.selectAll("path.link").data(r,function(t){return t.target.id});d.enter().insert("path","g").attr("class","link").attr("d",function(e){var n={x:t.x0,y:t.y0};return p({source:n,target:n})}),d.transition().duration(f).attr("d",p),d.exit().transition().duration(f).attr("d",function(e){var n={x:t.x,y:t.y};return p({source:n,target:n})}).remove(),n.forEach(function(t){t.x0=t.x,t.y0=t.y})},y=function(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),x(t)},m=function(t){t.children&&(t._children=t.children,t._children.forEach(m),t.children=null)},k=function(t){l=t,l.x0=c/2,l.y0=0,t.children.forEach(m),x(t)};t.jsonPath?d.json(t.jsonPath,function(t,e){return t?void console.error(t):void k(e)}):t.$watch("data",function(t,e){return t?k(t):void 0},!0),d.select(self.frameElement).style("height",c+"px")}}}).directive("radialCluster",function(t,n){return{restrict:"EA",scope:{data:"=",labelMap:"=",jsonPath:"@",radius:"@",id:"@"},template:"<svg></svg>",link:function(t,r,a){var l=t.radius,i=t.labelMap,o=n.d3,c=o.layout.cluster().size([360,l-120]),s=r.find("svg"),d=o.select(s[0]).attr("width",2*l).attr("height",2*l).append("g").attr("transform","translate("+l+","+l+")"),u=o.svg.diagonal.radial().projection(function(t){return[t.y,t.x/180*Math.PI]}),f=function(t){d.selectAll("*").remove();var n=c.nodes(t),r=c.links(n),a=(d.selectAll("path.link").data(r).enter().append("path").attr("class","link").attr("d",u),d.selectAll("g.node").data(n).enter().append("g").attr("class","node").attr("transform",function(t){return"rotate("+(t.x-90)+")translate("+t.y+")"}));a.append("circle").attr("r",4.5),a.append("text").attr("dy",".31em").attr("text-anchor",function(t){return t.x<180?"start":"end"}).attr("transform",function(t){return t.x<180?"translate(8)":"rotate(180)translate(-8)"}).text(function(t){return e(t,i)})};t.jsonPath?o.json(t.jsonPath,function(t,e){return t?void console.error(t):void f(e)}):t.$watch("data",function(t,e){return t?f(t):void 0},!0),o.select(self.frameElement).style("height",2*l+"px")}}}).directive("forceLayout",function(t,n){return{restrict:"EA",scope:{data:"=",labelMap:"=",jsonPath:"@",width:"@",height:"@",id:"@"},template:"<svg></svg>",link:function(t,r,a){var l=t.width,i=t.height,o=t.labelMap,c=n.d3,s=r.find("svg"),d=c.select(s[0]).attr("width",l).attr("height",i).append("g").attr("pointer-events","all"),u=function(t){console.log("json"),console.log(t),d.selectAll("*").remove();var n=c.layout.force().nodes(t.nodes).links(t.links).gravity(.05).linkDistance(l/10).charge(-100).size([l,i]).start(),r=d.selectAll("line.link").data(t.links).enter().append("line").attr("class","link"),a=d.selectAll("g.node").data(t.nodes).enter().append("g").attr("class","node").call(n.drag);a.append("text").attr("class","nodetext").attr("dx",12).attr("dy",".35em").text(function(t){return e(t,o)}),a.append("circle").attr("r",4.5),n.on("tick",function(){r.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),a.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})};t.jsonPath?c.json(t.jsonPath,function(t,e){return t?void console.error(t):void u(e)}):t.$watch("data",function(t,e){return t?u(t):void 0},!0),c.select(self.frameElement).style("height",i+"px")}}}).directive("dragAndDropCollapsible",function(t,e){return{restrict:"EA",scope:{data:"=",labelMap:"=",jsonPath:"@",width:"@",height:"@",id:"@"},template:"<svg></svg>",link:function(t,n,r){var a,l=t.width,i=t.height,o=(t.labelMap,e.d3),c=o.layout.tree().size([i,l-160]),s=0,d=0,u=null,f=null,h=200,p=20,g=0,v=750,x=l,y=i,m=null,k=null,b=null,A=function(t){function e(t,n,r){if(t){n(t);var a=r(t);if(a)for(var l=a.length,i=0;l>i;i++)e(a[i],n,r)}}function r(t,e){var n=h;if(panTimer){clearTimeout(panTimer),translateCoords=o.transform(I.attr("transform")),"left"==e||"right"==e?(translateX="left"==e?translateCoords.translate[0]+n:translateCoords.translate[0]-n,translateY=translateCoords.translate[1]):("up"==e||"down"==e)&&(translateX=translateCoords.translate[0],translateY="up"==e?translateCoords.translate[1]+n:translateCoords.translate[1]-n),scaleX=translateCoords.scale[0],scaleY=translateCoords.scale[1];var a=D.scale();I.transition().attr("transform","translate("+translateX+","+translateY+")scale("+a+")"),o.select(t).select("g.node").attr("transform","translate("+translateX+","+translateY+")"),D.scale(D.scale()),D.translate([translateX,translateY]),panTimer=setTimeout(function(){r(t,n,e)},50)}}function A(t,e){f=t,o.select(e).select(".ghostCircle").attr("pointer-events","none"),o.selectAll(".ghostCircle").attr("class","ghostCircle show"),o.select(e).attr("class","node activeDrag"),I.selectAll("g.node").sort(function(t,e){return t.id!=f.id?1:-1}),k.length>1&&(b=c.links(k),nodePaths=I.selectAll("path.link").data(b,function(t){return t.target.id}).remove(),nodesExit=I.selectAll("g.node").data(k,function(t){return t.id}).filter(function(t,e){return t.id==f.id?!1:!0}).remove());c.links(c.nodes(f.parent));I.selectAll("path.link").filter(function(t,e){return t.target.id==f.id?!0:!1}).remove(),m=null}var j=function(t){u=null,o.selectAll(".ghostCircle").attr("class","ghostCircle"),o.select(t).attr("class","node"),o.select(t).select(".ghostCircle").attr("pointer-events",""),P(),null!==f&&(O(a),T(f),f=null)},w=function(t){t.children&&(t._children=t.children,t._children.forEach(w),t.children=null)},_=function(t){t._children&&(t.children=t._children,t.children.forEach(_),t._children=null)},C=function(t){u=t,P()},E=function(t){u=null,P()},P=function(){var t=[];null!==f&&null!==u&&(t=[{source:{x:u.y0,y:u.x0},target:{x:f.y0,y:f.x0}}]);var e=I.selectAll(".templink").data(t);e.enter().append("path").attr("class","templink").attr("d",o.svg.diagonal()).attr("pointer-events","none"),e.attr("d",o.svg.diagonal()),e.exit().remove()},T=function(t){var e=D.scale(),n=-t.y0,r=-t.x0;n=n*e+x/2,r=r*e+y/2,o.select("g").transition().duration(v).attr("transform","translate("+n+","+r+")scale("+e+")"),D.scale(e),D.translate([n,r])},M=function(t){return t.children?(t._children=t.children,t.children=null):t._children&&(t.children=t._children,t._children=null),t},z=function(t){o.event.defaultPrevented||(t=M(t),O(t),T(t))},X=o.svg.diagonal().projection(function(t){return[t.y,t.x]}),Y=function(){I.attr("transform","translate("+o.event.translate+")scale("+o.event.scale+")")},D=o.behavior.zoom().scaleExtent([.1,3]).on("zoom",Y),O=function(t){var e=[1],n=function(t,r){r.children&&r.children.length>0&&(e.length<=t+1&&e.push(0),e[t+1]+=r.children.length,r.children.forEach(function(e){n(t+1,e)}))};n(0,a);var r=25*o.max(e);c=c.size([r,x]),k=c.nodes(a).reverse(),b=c.links(k),k.forEach(function(t){t.y=t.depth*(10*d)});var l=I.selectAll("g.node").data(k,function(t){return t.id||(t.id=++g)}),i=l.enter().append("g").call(q).attr("class","node").attr("transform",function(e){return"translate("+t.y0+","+t.x0+")"}).on("click",z);i.append("circle").attr("class","nodeCircle").attr("r",0).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),i.append("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("class","nodeText").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}).style("fill-opacity",0),i.append("circle").attr("class","ghostCircle").attr("r",30).attr("opacity",.2).style("fill","red").attr("pointer-events","mouseover").on("mouseover",function(t){C(t)}).on("mouseout",function(t){E(t)}),l.select("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}),l.select("circle.nodeCircle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"});var s=l.transition().duration(v).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});s.select("text").style("fill-opacity",1);var u=l.exit().transition().duration(v).attr("transform",function(e){return"translate("+t.y+","+t.x+")"}).remove();u.select("circle").attr("r",0),u.select("text").style("fill-opacity",0);var f=I.selectAll("path.link").data(b,function(t){return t.target.id});f.enter().insert("path","g").attr("class","link").attr("d",function(e){var n={x:t.x0,y:t.y0};return X({source:n,target:n})}),f.transition().duration(v).attr("d",X),f.exit().transition().duration(v).attr("d",function(e){var n={x:t.x,y:t.y};return X({source:n,target:n})}).remove(),k.forEach(function(t){t.x0=t.x,t.y0=t.y})};e(t,function(t){s++,d=Math.max(t.name.length,d)},function(t){return t.children&&t.children.length>0?t.children:null});var L=n.find("svg");o.select(L[0]).selectAll("*").remove();var F=o.select(L[0]).attr("width",l).attr("height",i).attr("class","overlay").call(D),I=F.append("g"),q=o.behavior.drag().on("dragstart",function(t){t!=a&&(m=!0,k=c.nodes(t),o.event.sourceEvent.stopPropagation())}).on("drag",function(t){if(t!=a){if(m){var e=this;A(t,e)}if(relCoords=o.mouse($("svg").get(0)),relCoords[0]<p)panTimer=!0,r(this,"left");else if(relCoords[0]>$("svg").width()-p)panTimer=!0,r(this,"right");else if(relCoords[1]<p)panTimer=!0,r(this,"up");else if(relCoords[1]>$("svg").height()-p)panTimer=!0,r(this,"down");else try{clearTimeout(panTimer)}catch(n){}t.x0+=o.event.dy,t.y0+=o.event.dx;var l=o.select(this);l.attr("transform","translate("+t.y0+","+t.x0+")"),P()}}).on("dragend",function(t){if(t!=a){var e=this;if(u&&null!=f){var n=f.parent.children.indexOf(f);n>-1&&f.parent.children.splice(n,1),"undefined"!=typeof u.children||"undefined"!=typeof u._children?"undefined"!=typeof u.children?u.children.push(f):u._children.push(f):(u.children=[],u.children.push(f)),_(u),j(e)}else j(e)}});a=t,a.x0=y/2,a.y0=0,a.children.forEach(function(t){w(t)}),O(a),T(a)};t.jsonPath?o.json(t.jsonPath,function(t,e){return t?void console.error(t):void A(e)}):t.$watch("data",function(t,e){return t?A(t):void 0},!0),o.select(self.frameElement).style("height",i+"px")}}})}();
